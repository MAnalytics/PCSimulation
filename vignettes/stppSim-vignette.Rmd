---
title: "An R package for synthesizing spatiotemporal point patterns for social and life science research - A user guide"

author: |
  | Monsuru Adepeju^[Big Data Centre, Manchester Metropolitan University, Manchester, M156BH, UK, m.adepeju@mmu.ac.uk]
  | Meng Le Zhang^[Interdisciplinary Centre of Social Sciences, University of Sheffield, S14DP, UK, mengle.zhang@sheffield.ac.uk] 
  
date: |
  | `Date:`
  | ``r Sys.Date()``

#output:
  #pdf_vignette
  
output:
  pdf_document

urlcolor: blue

toc:
  true

number_sections: 
  yes
    
linestretch: 
  1.5
  
fontsize: 
  16pt

#header-includes:
 # - \usepackage{leading}
  #- \leading{18}
  
#dev: png
#output:
  #word_document: default
  #always_allow_html: yes
#  pdf_document: default
always_allow_html: yes
#fig_caption: yes
bibliography: references.bib

abstract: Generates artificial spatio-temporal point patterns (stpp) through the integration of microsimulation and agent-based models. Allows a user to define the movement characteristics of a set of "walkers" (agents) across a spatially configured landscape. The interaction between the walkers (be it human offenders in crime studies, foraging animals in Wildlife studies, or disease carriers in epidemiology) and the environment results in the advent of new events, whose spatiotemporal (ST) signatures can be measured at the global levels. With increasingly limited availability of fine-grained spatially and temporally stamped point data, `stppSim` provides alternative source of datasets for ST model testing and evaluation across a wide variety of fields in social and life sciences.

vignette: >
  %\VignetteIndexEntry{An R package for synthesizing spatiotemporal point patterns for social and life science research - A user guide}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r functions, include=FALSE}
# A function for captioning and referencing images
fig <- local({
  i <- 0
  ref <- list()
  list(
    cap=function(refName, text) {
      i <<- i + 1
      ref[[refName]] <<- i
      paste("Figure ", i, ": ", text, sep="")
    },
    ref=function(refName) {
      ref[[refName]]
    })
})
```

## Introduction

In many context, access to fine-grained spatiotemporal (ST) point data have been severely restricted due to privacy concerns. As an alternative, synthesized data which mimic the real-life data have been utilized in a wide range of research contexts. The `R-stppSim` package is designed for synthesizing spatiotemporal point patterns within a defined landscape coverage. The package combines microsimulation and agent-based models, allowing a user to construct movement characteristics of `walkers` (i.e., agents) across the space. As the `walkers` interact with their environment,  new cases of events originate - the cumulative of which produces spatiotemporal signatures at the global levels. These signatures can be utilized for testing and evaluation of spatiotemporal models.

The package contains two primary functions for synthesizing artificial `stpp` data: `psim_artif` and `psim_real`. The `psim_artif` synthesizes ST point pattern from scratch. That is, given a landscape configuration, the movement characteristics of `walkers` as well as the landscape features are defined by the user. On the other hand, `psim_real` synthesizes ST point pattern from a sample (or a sparse version) of a real data. The function learns (or extracts) certain characteristics of the sample data, and utilizes them to configures the behaviours of the `walkers` as they move across teh space. The potential application fields for `stppSim` include criminology, epidemiology, and wildlife science.


### Key properties of a walker.

The following are the key properties controlling the movement behaviours of a walker:

* Origins (`coords`) - A set of xy coordinates representing the initial location of the walkers. A `origin` could be a home of a human offender (in Criminology).
* Movement (`transition matrix`) - An in-built stochastic property that controls the `direction` and the `transition states` of a walker. At any instant, a walker can assume one of the two states, namely; an `exploratory` and a `performative` states (See the manual for details).
* Spatial threshold (`s_threshold`) - The perception range of a walker at any point in time. The range is generally updated as a walker moves to a new location.
* Steps (`step_length`) - The maximum step taken by a walker at a time.

### Landscape

The boundary shapefile (`poly`) defines the extent of a landscape which can be of two types: 

1. `Retricted` - Contains environmental features that restrict the movement of walkers across the landscape. Examples of such features include route network and mountains. Different classes of feature can have varying restriction (resistance) levels. For example, a gated property may be harder (high resistance) to burgle compared to an open one (low resistance).  

2. `Unrestricted` - Contains no features or all features has zero resistance level.

## Spatiotemporal point patterns

The following steps demonstrate how `stppSim` package can be used to simulate spatiotemporal point patterns:

### Install the package from `CRAN`

From an R console, type:

```{r eval=FALSE, message=FALSE, warning=FALSE}
#install.packages("stppSim")
library(stppSim)
```

To install the developmental version of the package, use the follow codes:

```{r eval=FALSE, message=FALSE, warning=FALSE}
#install.packages("stppSim")
remotes::install_github("MAnalytics/stppSim")
library(stppSim)
```

Note: `remotes` is an extra package that needed to be installed prior to the running of this code. 


### stpp simulation from scratch

To simulate `stpp`, key parameters include the `n_events` denoting the number of events to generate. It is however, advisable to supply a vector with different values

#### On an unrestricted landscape

```{r eval=FALSE, message=FALSE, warning=FALSE}
data(camden_boundary)
data(landuse)
artif_stpp <- psim_artif(n_events=200, start_date = "2021-01-01",
poly=camden_boundary, n_origin=50, resistance_feat = landuse,
field = "rValue1",
n_foci=5, foci_separation = 10, conc_type = "dispersed",
p_ratio = 20, s_threshold = 50, step_length = 20,
trend = "stable", first_pDate=NULL,
slope = NULL,show.plot=FALSE, show.data=FALSE)
```

The computational time:

#### On a restricted landscape
```{r eval=FALSE, message=FALSE, warning=FALSE}
data(camden_boundary)
data(landuse)
artif_stpp <- psim_artif(n_events=200, start_date = "2021-01-01",
poly=camden_boundary, n_origin=50, resistance_feat = landuse,
field = "rValue1",
n_foci=5, foci_separation = 10, conc_type = "dispersed",
p_ratio = 20, s_threshold = 50, step_length = 20,
trend = "stable", first_pDate=NULL,
slope = NULL,show.plot=FALSE, show.data=FALSE)
```

Computational time

#plotting the results


### stpp simulation from a sample dataset

Here, we are going to use a small sample of a data to simulate the full dataset. We will then compare the real full data with the simulated data.

```{r eval=FALSE, message=FALSE, warning=FALSE}
data(camden_crimes)
#subset 'theft' crime
theft <- camden_crimes[which(camden_crimes$type ==
"Theft"),]
#specify the proportion of full data to use
sample_size <- 0.2
set.seed(1000)
dat_sample <- theft[sample(1:nrow(theft),
round((sample_size * nrow(theft)), digits=0),
replace=FALSE),1:3]
#plot(dat_sample$x, dat_sample$y) #preview
result <- psim_real(n_events=2000, ppt=dat_sample,
start_date = NULL, poly = NULL, s_threshold = NULL,
step_length = 20, n_origin=50, resistance_feat, field=NA,
p_ratio=20, crsys = "EPSG:27700")
```



We are going to compare real (full) data and the simulated one in terms of their spatial and temporal characteristics. Recall that a user would have no idea of case count. So, the number to simulate is left to the discretion of the use. You can infer the potential size from any available data from previus years.


Note:
applications. Certain areas, only sparse data are availabe;... 
